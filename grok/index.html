
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fretcream - Guitar Fretboard Visualizer</title>
    <style>
        body {
            font-family: 'Georgia', serif;
            margin: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: background-color 0.3s ease, color 0.3s ease;
            min-height: 100vh;
        }
        body.light {
            background-color: #f5e8c7; /* Warm beige */
            color: #4a3728; /* Dark brown */
        }
        body.dark {
            background-color: #2f2f2f; /* Dark earthy gray */
            color: #d8c4a3; /* Light beige */
        }
        h1 {
            font-size: clamp(20px, 5vw, 24px);
            margin: 10px 0;
            font-weight: normal;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            width: 100%;
            max-width: 600px;
            box-sizing: border-box;
        }
        body.light .controls {
            background-color: #e4d3a8; /* Light earthy tan */
        }
        body.dark .controls {
            background-color: #4a3728; /* Dark brown */
        }
        label {
            font-size: clamp(12px, 3vw, 14px);
        }
        select, input[type="checkbox"] {
            padding: 6px;
            font-size: clamp(12px, 3vw, 14px);
            border-radius: 5px;
            border: 1px solid #8b7b5a; /* Muted olive */
            background-color: #fff;
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }
        select:focus, input:focus {
            outline: none;
            border-color: #a68a64; /* Warm taupe */
            background-color: #f5e8c7;
        }
        button {
            padding: 6px 10px;
            font-size: clamp(12px, 3vw, 14px);
            border-radius: 5px;
            border: 1px solid #8b7b5a;
            background-color: #a68a64;
            color: #fff;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #8b7b5a;
        }
        .fretboard-container {
            overflow-x: auto;
            width: 100%;
            max-width: 600px;
            margin-bottom: 20px;
        }
        table {
            border-collapse: separate;
            border-spacing: 0;
            background-color: #5c4033; /* Rich walnut wood */
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s ease;
            min-width: 600px;
        }
        th, td {
            padding: 2px 4px;
            text-align: center;
            width: clamp(30px, 5vw, 34px);
            height: clamp(14px, 3vw, 16px);
            font-size: clamp(9px, 2.5vw, 10px);
            transition: background-color 0.3s ease;
            position: relative;
        }
        th {
            background-color: #3a2e22; /* Darker wood */
            font-weight: normal;
            color: #d8c4a3;
        }
        td:first-child {
            background-color: #3a2e22;
            width: clamp(24px, 4vw, 26px);
            font-weight: bold;
            color: #d8c4a3;
        }
        .note-cell {
            font-weight: bold;
            border-radius: 50%;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
            cursor: pointer;
        }
        .fret-0, .fret-3, .fret-5, .fret-7, .fret-9, .fret-12 {
            background-color: #634935; /* Slightly lighter wood */
        }
        .fret-3::after, .fret-5::after, .fret-7::after, .fret-9::after, .fret-12::after {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #a68a64; /* Taupe fret wire */
            z-index: 1;
        }
        .fret-12::after {
            width: 3px;
            background: linear-gradient(to right, #a68a64 33%, transparent 33%, transparent 66%, #a68a64 66%);
        }
        .piano-container {
            overflow-x: auto;
            width: 100%;
            max-width: 600px;
        }
        .piano {
            display: flex;
            min-width: 2100px; /* Approx width for 88 keys */
            background-color: #5c4033; /* Match fretboard */
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            padding: 5px;
        }
        .key {
            position: relative;
            flex: 1;
            height: clamp(40px, 10vw, 50px);
            border: 1px solid #3a2e22;
            transition: background-color 0.3s ease;
            cursor: pointer;
        }
        .key.white {
            background-color: #f5e8c7; /* Light beige */
        }
        body.dark .key.white {
            background-color: #d8c4a3;
        }
        .key.black {
            background-color: #3a2e22; /* Dark wood */
            height: clamp(25px, 6vw, 30px);
            margin: 0 -12px;
            z-index: 2;
        }
        body.dark .key.black {
            background-color: #4a3728;
        }
        .key.active {
            font-weight: bold;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        .key.active::after {
            content: attr(data-note);
            position: absolute;
            bottom: 5px;
            width: 100%;
            text-align: center;
            font-size: clamp(8px, 2vw, 9px);
            color: #4a3728;
        }
        body.dark .key.active::after {
            color: #d8c4a3;
        }
        .key.black.active::after {
            color: #d8c4a3;
        }
        body.dark .key.black.active::after {
            color: #f5e8c7;
        }
        /* Earthy chakra colors */
        .color-A { background-color: #4a7043; } /* Forest green (Ajna) */
        .color-B { background-color: #8b7b5a; } /* Muted olive (Sahasrara) */
        .color-C { background-color: #8c2f2f; } /* Deep terracotta (Muladhara) */
        .color-D { background-color: #d68a38; } /* Warm clay (Svadhishthana) */
        .color-E { background-color: #e4b04a; } /* Sandy yellow (Manipura) */
        .color-F { background-color: #5b8c5a; } /* Sage green (Anahata) */
        .color-G { background-color: #4a8294; } /* Slate blue (Vishuddha) */
        @media (max-width: 600px) {
            .controls {
                flex-direction: column;
                align-items: flex-start;
            }
            .fretboard-container, .piano-container {
                -webkit-overflow-scrolling: touch;
            }
        }
    </style>
</head>
<body class="light">
    <h1>Fretcream</h1>
    <div class="controls">
        <label for="key">Key:</label>
        <select id="key">
            <option value="A">A</option>
            <option value="A#">A#</option>
            <option value="B">B</option>
            <option value="C">C</option>
            <option value="C#">C#</option>
            <option value="D">D</option>
            <option value="D#">D#</option>
            <option value="E">E</option>
            <option value="F">F</option>
            <option value="F#">F#</option>
            <option value="G">G</option>
            <option value="G#">G#</option>
        </select>

        <label for="mode">Mode/Scale:</label>
        <select id="mode">
            <option value="Ionian">Ionian (Major)</option>
            <option value="Dorian">Dorian</option>
            <option value="Phrygian">Phrygian</option>
            <option value="Lydian">Lydian</option>
            <option value="Mixolydian">Mixolydian</option>
            <option value="Aeolian">Aeolian (Minor)</option>
            <option value="Locrian">Locrian</option>
            <option value="MajorPentatonic">Major Pentatonic</option>
            <option value="MinorPentatonic">Minor Pentatonic</option>
            <option value="Blues">Blues</option>
            <option value="WholeTone">Whole Tone</option>
            <option value="HarmonicMinor">Harmonic Minor</option>
            <option value="MelodicMinor">Melodic Minor</option>
        </select>

        <label for="dropD">Drop D:</label>
        <input type="checkbox" id="dropD">

        <label for="layout-toggle">Low String Top:</label>
        <input type="checkbox" id="layout-toggle">

        <button id="theme-toggle">Toggle Dark/Light</button>
    </div>

    <div class="fretboard-container">
        <table id="fretboard">
            <thead>
                <tr>
                    <th>String</th>
                    <th class="fret-0">0</th>
                    <th>1</th>
                    <th>2</th>
                    <th class="fret-3">3</th>
                    <th>4</th>
                    <th class="fret-5">5</th>
                    <th>6</th>
                    <th class="fret-7">7</th>
                    <th>8</th>
                    <th class="fret-9">9</th>
                    <th>10</th>
                    <th>11</th>
                    <th class="fret-12">12</th>
                    <th>13</th>
                </tr>
            </thead>
            <tbody>
                <tr data-string="6"><td>E</td></tr> <!-- Low E/D -->
                <tr data-string="5"><td>A</td></tr>
                <tr data-string="4"><td>D</td></tr>
                <tr data-string="3"><td>G</td></tr>
                <tr data-string="2"><td>B</td></tr>
                <tr data-string="1"><td>e</td></tr> <!-- High E -->
            </tbody>
        </table>
    </div>

    <div class="piano-container">
        <div class="piano" id="piano">
            <!-- Piano keys generated dynamically -->
        </div>
    </div>

    <script>
        const notes = ['A', 'A#', 'B', 'C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#'];
        const modes = {
            Ionian: [0, 2, 4, 5, 7, 9, 11],
            Dorian: [0, 2, 3, 5, 7, 9, 10],
            Phrygian: [0, 1, 3, 5, 7, 8, 10],
            Lydian: [0, 2, 4, 6, 7, 9, 11],
            Mixolydian: [0, 2, 4, 5, 7, 9, 10],
            Aeolian: [0, 2, 3, 5, 7, 8, 10],
            Locrian: [0, 1, 3, 5, 6, 8, 10],
            MajorPentatonic: [0, 2, 4, 7, 9],
            MinorPentatonic: [0, 3, 5, 7, 10],
            Blues: [0, 3, 5, 6, 7, 10],
            WholeTone: [0, 2, 4, 6, 8, 10],
            HarmonicMinor: [0, 2, 3, 5, 7, 8, 11],
            MelodicMinor: [0, 2, 3, 5, 7, 9, 11]
        };
        const chakraColors = {
            'A': 'A',
            'B': 'B',
            'C': 'C',
            'D': 'D',
            'E': 'E',
            'F': 'F',
            'G': 'G'
        };
        const standardTuning = ['E', 'A', 'D', 'G', 'B', 'E']; // Strings 6 to 1, low to high
        const dropDTuning = ['D', 'A', 'D', 'G', 'B', 'E'];
        const openStringMidi = {
            'E': 40, // Low E (string 6)
            'A': 45, // A (string 5)
            'D': 50, // D (string 4)
            'G': 55, // G (string 3)
            'B': 59, // B (string 2)
            'e': 64  // High E (string 1)
        };
        const pianoNotes = ['A', 'A#', 'B', 'C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#'];
        const pianoMidiStart = 21; // A0
        const pianoMidiEnd = 108; // C8

        // Web Audio API setup
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let currentOscillator = null;

        function getFrequency(midiNote) {
            return 440 * Math.pow(2, (midiNote - 69) / 12);
        }

        function playNote(midiNote) {
            if (currentOscillator) {
                currentOscillator.stop();
                currentOscillator = null;
            }
            const oscillator = audioContext.createOscillator();
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(getFrequency(midiNote), audioContext.currentTime);
            oscillator.connect(audioContext.currentTime ? audioContext.destination : audioContext);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.5);
            currentOscillator = oscillator;
        }

        function getNote(base, fret) {
            const baseIndex = notes.indexOf(base);
            return notes[(baseIndex + fret) % 12];
        }

        function getScaleNotes(root, mode) {
            const rootIndex = notes.indexOf(root);
            return modes[mode].map(interval => notes[(rootIndex + interval) % 12]);
        }

        function getChakraClass(note) {
            const letter = note.replace('#', '');
            return `color-${chakraColors[letter]}`;
        }

        function populateFretboard() {
            const key = document.getElementById('key').value;
            const mode = document.getElementById('mode').value;
            const dropD = document.getElementById('dropD').checked;
            const lowStringTop = document.getElementById('layout-toggle').checked;
            const tuning = dropD ? dropDTuning : standardTuning;
            const scaleNotes = getScaleNotes(key, mode);

            // Populate fretboard
            const tbody = document.querySelector('#fretboard tbody');
            tbody.querySelectorAll('tr').forEach(tr => tr.remove());

            const stringOrder = lowStringTop ? [1, 2, 3, 4, 5, 6] : [6, 5, 4, 3, 2, 1];
            stringOrder.forEach(stringIndex => {
                const openNote = tuning[stringIndex - 1];
                const row = document.createElement('tr');
                row.setAttribute('data-string', stringIndex);
                
                const stringLabel = document.createElement('td');
                stringLabel.textContent = openNote.toLowerCase();
                row.appendChild(stringLabel);

                for (let fret = 0; fret <= 13; fret++) {
                    const note = getNote(openNote, fret);
                    const td = document.createElement('td');
                    if (scaleNotes.includes(note)) {
                        td.textContent = note;
                        td.classList.add('note-cell', getChakraClass(note));
                        const midiNote = openStringMidi[openNote.toLowerCase()] + fret;
                        td.addEventListener('click', () => playNote(midiNote));
                    } else {
                        td.textContent = '';
                    }
                    if (fret === 0) td.classList.add('fret-0');
                    else if (fret === 3) td.classList.add('fret-3');
                    else if (fret === 5) td.classList.add('fret-5');
                    else if (fret === 7) td.classList.add('fret-7');
                    else if (fret === 9) td.classList.add('fret-9');
                    else if (fret === 12) td.classList.add('fret-12');
                    row.appendChild(td);
                }

                tbody.appendChild(row);
            });

            // Populate piano roll
            const piano = document.getElementById('piano');
            piano.innerHTML = '';
            for (let midi = pianoMidiStart; midi <= pianoMidiEnd; midi++) {
                const noteIndex = (midi - pianoMidiStart) % 12;
                const note = pianoNotes[noteIndex];
                const key = document.createElement('div');
                key.classList.add('key', note.includes('#') ? 'black' : 'white');
                key.setAttribute('data-note', note);
                if (scaleNotes.includes(note)) {
                    key.classList.add('active', getChakraClass(note));
                }
                key.addEventListener('click', () => playNote(midi));
                piano.appendChild(key);
            }
        }

        // Theme toggle
        document.getElementById('theme-toggle').addEventListener('click', () => {
            document.body.classList.toggle('light');
            document.body.classList.toggle('dark');
        });

        // Layout toggle
        document.getElementById('layout-toggle').addEventListener('change', populateFretboard);

        // Initial population
        populateFretboard();

        // Event listeners
        document.getElementById('key').addEventListener('change', populateFretboard);
        document.getElementById('mode').addEventListener('change', populateFretboard);
        document.getElementById('dropD').addEventListener('change', populateFretboard);
    </script>
</body>
</html>
